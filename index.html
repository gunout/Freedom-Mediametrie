<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FREE DOM ‚Ä¢ Tableau de Bord Officiel M√©diam√©trie</title>
    <style>
        /* M√™mes styles que pr√©c√©demment, en ajoutant un indicateur d'alerte */
        .alert-outdated {
            background: linear-gradient(135deg, #ff3366, #ff0066);
            color: white;
            padding: 15px 25px;
            border-radius: 50px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            animation: pulse-alert 2s infinite;
        }
        
        @keyframes pulse-alert {
            0% { opacity: 0.9; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.02); }
            100% { opacity: 0.9; transform: scale(1); }
        }
        
        .update-now-btn {
            background: rgba(255,255,255,0.2);
            border: 1px solid white;
            color: white;
            padding: 8px 20px;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-left: auto;
        }
        
        .update-now-btn:hover {
            background: white;
            color: #ff3366;
        }
    </style>
</head>
<body>
    <div class="particles" id="particles"></div>

    <div class="container">
        <!-- Alerte si donn√©es obsol√®tes -->
        <div class="alert-outdated" id="outdatedAlert" style="display: none;">
            <i class="fas fa-exclamation-triangle"></i>
            <span id="alertMessage">Les donn√©es affich√©es datent de plus de 2 mois !</span>
            <button class="update-now-btn" onclick="forceUpdate()">
                <i class="fas fa-sync-alt"></i> Mettre √† jour maintenant
            </button>
        </div>

        <!-- Header -->
        <div class="header">
            <div class="header-content">
                <div class="logo">
                    FREE DOM
                </div>
                <div class="mediametrie-badge">
                    <i class="fas fa-chart-line mediametrie-icon"></i>
                    <span id="periodDisplay">M√âDIAM√âTRIE ‚Ä¢ CHARGEMENT...</span>
                </div>
                <div class="last-update" id="updateDisplay">
                    <i class="fas fa-sync-alt"></i>
                    <span id="updateText">Mise √† jour: chargement...</span>
                </div>
            </div>
        </div>

        <!-- Indicateur de mise √† jour hebdomadaire -->
        <div class="update-indicator">
            <i class="fas fa-calendar-week" style="color: var(--freedom-cyan);"></i>
            <span>Mise √† jour automatique tous les lundis ‚Ä¢ Prochaine mise √† jour: <span id="nextUpdate">...</span></span>
            <i class="fas fa-check-circle" style="color: var(--success); margin-left: auto;" id="updateStatus"></i>
        </div>

        <!-- Stats principales -->
        <div class="main-stats">
            <div class="stat-card">
                <div class="stat-header">
                    <div class="stat-icon">üìª</div>
                    <div class="stat-source">Free Dom 1</div>
                </div>
                <div class="stat-value" id="freedom1Pda">---</div>
                <div class="stat-label">PART D'AUDIENCE (PDA)</div>
                <div class="stat-trend" id="freedom1Trend1"></div>
                <div class="stat-trend" id="freedom1Trend2"></div>
            </div>

            <div class="stat-card">
                <div class="stat-header">
                    <div class="stat-icon">üë•</div>
                    <div class="stat-source">Free Dom 1</div>
                </div>
                <div class="stat-value" id="audienceValue">---</div>
                <div class="stat-label">AUDITEURS QUOTIDIENS</div>
                <div class="stat-trend" id="audienceTrend"></div>
                <div class="stat-trend">
                    <span id="cumulValue">---</span> d'audience cumul√©e
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-header">
                    <div class="stat-icon">‚è±Ô∏è</div>
                    <div class="stat-source">Free Dom 1</div>
                </div>
                <div class="stat-value" id="dureeValue">---</div>
                <div class="stat-label">DUR√âE D'√âCOUTE QUOTIDIENNE</div>
                <div class="stat-trend" id="dureeTrend"></div>
            </div>
        </div>

        <!-- Classement g√©n√©ral des radios -->
        <div class="ranking-grid">
            <div class="chart-card">
                <div class="chart-header">
                    <div class="chart-title">
                        <i class="fas fa-trophy"></i> CLASSEMENT G√âN√âRAL (PDA)
                        <span id="rankingPeriod">CHARGEMENT</span>
                    </div>
                </div>
                <div class="ranking-list" id="ranking-list">
                    <div style="text-align: center; padding: 50px; color: var(--text-dim);">
                        <i class="fas fa-spinner fa-spin fa-3x"></i>
                        <p style="margin-top: 20px;">Chargement des donn√©es...</p>
                    </div>
                </div>
            </div>

            <div class="chart-card">
                <div class="chart-header">
                    <div class="chart-title">
                        <i class="fas fa-music"></i> FREE DOM 2
                        <span>PROGRESSION</span>
                    </div>
                </div>
                <div class="ranking-list">
                    <div class="ranking-item">
                        <div class="ranking-position" id="freedom2Rank">6</div>
                        <div class="ranking-info">
                            <div class="ranking-name">Free Dom 2</div>
                            <div class="ranking-details">
                                <span>PDA: <span class="ranking-value" id="freedom2Pda">---</span></span>
                                <span>√âvolution: <span class="trend-up" id="freedom2Trend">---</span></span>
                            </div>
                            <div class="progress-bar-container">
                                <div class="progress-bar" id="freedom2Progress" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                    <div style="margin-top: 20px; padding: 15px; background: rgba(0,255,136,0.05); border-radius: 15px;">
                        <div style="color: var(--success); font-weight: 600;" id="freedom2Highlight">üìà Plus forte progression du march√©</div>
                        <div style="color: var(--text-dim); font-size: 0.9em;" id="freedom2Detail">+1,9 point en un an</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- √âmissions phares -->
        <div class="chart-card">
            <div class="chart-header">
                <div class="chart-title">
                    <i class="fas fa-microphone-alt"></i> √âMISSIONS PHARES
                    <span>PROGRAMMATION 2026</span>
                </div>
            </div>
            <div class="shows-grid" id="showsGrid"></div>
        </div>

        <!-- Fr√©quences FM -->
        <div class="chart-card" style="margin-top: 25px;">
            <div class="chart-header">
                <div class="chart-title">
                    <i class="fas fa-broadcast-tower"></i> FR√âQUENCES FM ‚Ä¢ √éLE DE LA R√âUNION
                    <span>COUVERTURE TOTALE</span>
                </div>
            </div>
            <div class="frequencies-grid" id="frequenciesGrid"></div>
        </div>

        <!-- Footer -->
        <div class="footer">
            <div>FREE DOM ‚Ä¢ 1√àRE RADIO DE LA R√âUNION DEPUIS 1981</div>
            <div class="quote">
                <i class="fas fa-quote-left"></i> Nous informer, c'est vous informer <i class="fas fa-quote-right"></i>
            </div>
            <div class="source-note" id="sourceNote"></div>
        </div>
    </div>

    <script>
        // Configuration
        const DATA_URL = 'data.json?t=' + Date.now();
        const CURRENT_DATE = new Date('2026-02-18'); // Aujourd'hui

        // Donn√©es par d√©faut (les plus r√©centes disponibles)
        const defaultData = {
            lastUpdate: "2026-02-10",
            nextUpdate: "2026-02-17",
            period: "Novembre 2025-Janvier 2026",
            freedom1: {
                pda: 32.8,
                audience: 172500,
                cumul: 23.7,
                evolution: -0.7,
                evolutionYear: -6.5,
                audienceEvolution: -8,
                duree: "2h28"
            },
            freedom2: {
                pda: 5.7,
                evolution: 0.4,
                rank: 6,
                highlight: "Progression constante",
                detail: "+0,4 point sur le trimestre"
            },
            rankings: [
                {"position": 1, "name": "Free Dom 1", "pda": 32.8, "evolution": -0.7},
                {"position": 2, "name": "EXO FM", "pda": 11.9, "evolution": 0.6},
                {"position": 3, "name": "R√©union La 1√®re", "pda": 9.8, "evolution": -0.3},
                {"position": 4, "name": "Antenne R√©union Radio", "pda": 6.1, "evolution": 0.5},
                {"position": 5, "name": "Ch√©rie FM", "pda": 5.8, "evolution": -0.1},
                {"position": 6, "name": "Free Dom 2", "pda": 5.7, "evolution": 0.4},
                {"position": 7, "name": "NRJ R√©union", "pda": 4.1, "evolution": -0.2},
                {"position": 8, "name": "RER", "pda": 3.7, "evolution": -0.2},
                {"position": 9, "name": "Rire et Chansons", "pda": 1.8, "evolution": 0.1}
            ],
            shows: [
                { name: "TRAFIC", host: "Bobby", time: "15h-19h ‚Ä¢ Lundi-Vendredi", desc: "Toujours leader sur sa tranche" },
                { name: "DROIT DE PAROLE", host: "Mme Aude & Bobby", time: "17h-18h ‚Ä¢ Lundi-Vendredi", desc: "√âmission juridique, 39 ans d'existence" },
                { name: "LA MATINALE", host: "Francky", time: "6h-9h ‚Ä¢ Semaine", desc: "Audience en hausse +5%" },
                { name: "CHALEUR TROPICALE", host: "√âquipe", time: "20h-minuit ‚Ä¢ Tous les jours", desc: "Incontournable des soir√©es" },
                { name: "LE SON DU SOLEIL", host: "Max", time: "10h-15h", desc: "Musique et bonne humeur" },
                { name: "FREEDOMILLIONS", host: "√âquipe", time: "7h15, 8h15, 11h10", desc: "Jeu de cagnotte" }
            ],
            frequencies: [
                {"city": "Saint-Denis", "freq": "97.4"},
                {"city": "Saint-Pierre", "freq": "97.4"},
                {"city": "Saint-Paul", "freq": "95.0"},
                {"city": "Saint-Andr√©", "freq": "106.2"},
                {"city": "Saint-Beno√Æt", "freq": "101.3"},
                {"city": "Saint-Joseph", "freq": "106.1"},
                {"city": "Cilaos", "freq": "98.8"},
                {"city": "Le Port", "freq": "93.4"},
                {"city": "Saint-Gilles", "freq": "107.1"},
                {"city": "Saint-Leu", "freq": "95.0"},
                {"city": "Sainte-Suzanne", "freq": "103.8"},
                {"city": "La Possession", "freq": "93.4"}
            ]
        };

        function createParticles() {
            const particlesContainer = document.getElementById('particles');
            for (let i = 0; i < 50; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.top = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 20 + 's';
                particle.style.animationDuration = (15 + Math.random() * 10) + 's';
                particle.style.background = ['#0033A0', '#0066CC', '#00A0DF', '#00D4FF'][Math.floor(Math.random() * 4)];
                particlesContainer.appendChild(particle);
            }
        }

        function checkIfOutdated(lastUpdateDate) {
            const lastUpdate = new Date(lastUpdateDate);
            const diffMonths = (CURRENT_DATE.getFullYear() - lastUpdate.getFullYear()) * 12 + 
                              (CURRENT_DATE.getMonth() - lastUpdate.getMonth());
            
            const alertDiv = document.getElementById('outdatedAlert');
            if (diffMonths >= 2) {
                alertDiv.style.display = 'flex';
                document.getElementById('alertMessage').textContent = 
                    `‚ö†Ô∏è Les donn√©es datent de ${diffMonths} mois ! (${lastUpdateDate})`;
            } else {
                alertDiv.style.display = 'none';
            }
        }

        async function loadData() {
            try {
                const response = await fetch(DATA_URL);
                let data = defaultData;
                
                if (response.ok) {
                    data = await response.json();
                }
                
                updateUI(data);
                checkIfOutdated(data.lastUpdate);
                
            } catch (error) {
                console.error('Erreur chargement:', error);
                updateUI(defaultData);
                checkIfOutdated(defaultData.lastUpdate);
            }
        }

        function updateUI(data) {
            // Formatage des dates
            const lastUpdate = new Date(data.lastUpdate || '2026-02-10');
            const nextUpdate = new Date(lastUpdate);
            nextUpdate.setDate(lastUpdate.getDate() + 7);
            
            const options = { day: '2-digit', month: '2-digit', year: 'numeric' };
            
            document.getElementById('updateText').textContent = 
                `Mise √† jour: ${lastUpdate.toLocaleDateString('fr-FR', options)}`;
            document.getElementById('nextUpdate').textContent = 
                nextUpdate.toLocaleDateString('fr-FR', options);
            
            document.getElementById('periodDisplay').textContent = 
                `M√âDIAM√âTRIE ‚Ä¢ ${data.period || 'NOV 2025-JAN 2026'}`;
            
            // Stats Free Dom 1
            document.getElementById('freedom1Pda').textContent = data.freedom1.pda + '%';
            document.getElementById('audienceValue').textContent = 
                data.freedom1.audience.toLocaleString('fr-FR');
            document.getElementById('cumulValue').textContent = data.freedom1.cumul + '%';
            document.getElementById('dureeValue').textContent = data.freedom1.duree;
            
            document.getElementById('freedom1Trend1').innerHTML = `
                <span class="trend-down">‚ñº ${Math.abs(data.freedom1.evolution)} pt</span>
                <span>vs trimestre pr√©c√©dent</span>
            `;
            
            document.getElementById('freedom1Trend2').innerHTML = `
                <span class="trend-down">‚ñº ${Math.abs(data.freedom1.evolutionYear)} pts</span>
                <span>vs 2025</span>
            `;
            
            document.getElementById('audienceTrend').innerHTML = `
                <span class="trend-down">‚ñº ${Math.abs(data.freedom1.audienceEvolution)}%</span>
                <span>vs 2025</span>
            `;
            
            document.getElementById('dureeTrend').innerHTML = `
                <span class="trend-stable">‚óè Stable</span>
                <span>vs trimestre pr√©c√©dent</span>
            `;
            
            // Free Dom 2
            document.getElementById('freedom2Rank').textContent = data.freedom2.rank || 6;
            document.getElementById('freedom2Pda').textContent = data.freedom2.pda + '%';
            
            const trendClass = data.freedom2.evolution > 0 ? 'trend-up' : 'trend-down';
            const trendSymbol = data.freedom2.evolution > 0 ? '‚ñ≤' : '‚ñº';
            document.getElementById('freedom2Trend').innerHTML = 
                `<span class="${trendClass}">${trendSymbol} ${Math.abs(data.freedom2.evolution)} pt</span>`;
            
            const maxPda = 33.5;
            document.getElementById('freedom2Progress').style.width = 
                `${(data.freedom2.pda / maxPda) * 100}%`;
            
            document.getElementById('freedom2Highlight').textContent = 
                data.freedom2.highlight || 'üìà Progression constante';
            document.getElementById('freedom2Detail').textContent = 
                data.freedom2.detail || '+0,4 point sur le trimestre';
            
            document.getElementById('rankingPeriod').textContent = data.period || 'NOV 2025-JAN 2026';
            
            // Classement
            loadRanking(data.rankings);
            
            // √âmissions
            loadShows(data.shows);
            
            // Fr√©quences
            loadFrequencies(data.frequencies);
            
            // Source note
            document.getElementById('sourceNote').innerHTML = `
                <i class="fas fa-database"></i> Sources : M√©diam√©trie √âtude M√©tridom ${data.period}<br>
                <i class="fas fa-calendar-alt"></i> Derni√®re mise √† jour: ${lastUpdate.toLocaleDateString('fr-FR', options)}<br>
                <i class="fas fa-sync-alt"></i> Prochaine mise √† jour: ${nextUpdate.toLocaleDateString('fr-FR', options)}<br>
                <i class="fas fa-users"></i> Population de r√©f√©rence : 13 ans et plus, 732 000 personnes √† La R√©union
            `;
        }

        function loadRanking(rankingData) {
            const maxPda = 33.5;
            const listHtml = rankingData.map(item => `
                <div class="ranking-item">
                    <div class="ranking-position">
                        ${item.position}
                    </div>
                    <div class="ranking-info">
                        <div class="ranking-name">${item.name}</div>
                        <div class="ranking-details">
                            <span>PDA: <span class="ranking-value">${item.pda}%</span></span>
                            <span>√âvolution: <span class="${item.evolution > 0 ? 'trend-up' : item.evolution < 0 ? 'trend-down' : 'trend-stable'}">
                                ${item.evolution > 0 ? '‚ñ≤' : item.evolution < 0 ? '‚ñº' : '‚óè'} ${Math.abs(item.evolution)} pt
                            </span></span>
                        </div>
                        <div class="progress-bar-container">
                            <div class="progress-bar" style="width: ${(item.pda / maxPda) * 100}%"></div>
                        </div>
                    </div>
                </div>
            `).join('');

            document.getElementById('ranking-list').innerHTML = listHtml;
        }

        function loadShows(shows) {
            const showsHtml = shows.map(show => `
                <div class="show-card">
                    <div class="show-name">${show.name}</div>
                    <div class="show-host">${show.host}</div>
                    <div class="show-time">${show.time}</div>
                    <div class="ranking-details">${show.desc}</div>
                </div>
            `).join('');
            
            document.getElementById('showsGrid').innerHTML = showsHtml;
        }

        function loadFrequencies(frequencies) {
            const freqHtml = frequencies.map(f => `
                <div class="frequency-card">
                    <span class="frequency-city">${f.city}</span>
                    <span class="frequency-value">${f.freq}</span>
                </div>
            `).join('');
            
            document.getElementById('frequenciesGrid').innerHTML = freqHtml;
        }

        function forceUpdate() {
            // Force le rechargement des donn√©es
            document.getElementById('updateStatus').className = 'fas fa-sync-alt fa-spin';
            document.getElementById('updateStatus').style.color = 'var(--freedom-cyan)';
            
            fetch(DATA_URL)
                .then(response => response.json())
                .then(data => {
                    updateUI(data);
                    checkIfOutdated(data.lastUpdate);
                    document.getElementById('updateStatus').className = 'fas fa-check-circle';
                    document.getElementById('updateStatus').style.color = 'var(--success)';
                    
                    // Message de confirmation
                    const alertDiv = document.getElementById('outdatedAlert');
                    const originalContent = alertDiv.innerHTML;
                    alertDiv.innerHTML = `
                        <i class="fas fa-check-circle"></i>
                        <span>‚úÖ Donn√©es actualis√©es avec succ√®s !</span>
                        <button class="update-now-btn" onclick="location.reload()">
                            <i class="fas fa-sync-alt"></i> Rafra√Æchir
                        </button>
                    `;
                    alertDiv.style.background = 'linear-gradient(135deg, #00ff88, #00cc66)';
                    
                    setTimeout(() => {
                        location.reload();
                    }, 2000);
                })
                .catch(error => {
                    console.error('Erreur:', error);
                    document.getElementById('updateStatus').className = 'fas fa-exclamation-circle';
                    document.getElementById('updateStatus').style.color = 'var(--danger)';
                });
        }

        // Initialisation
        createParticles();
        loadData();
        
        // Rafra√Æchissement automatique toutes les heures
        setInterval(loadData, 3600000);
    </script>
</body>
</html>
